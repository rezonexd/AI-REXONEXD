<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>REZ‚Ä¢oneXD AI Chat</title>

<style>
body{
 background:#0b1220;
 color:white;
 font-family:Arial;
 margin:0;
}
.header{
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:12px;
 background:#0f1629;
 font-size:18px;
 font-weight:bold;
}
.icon{
 width:40px;
 height:40px;
 border-radius:50%;
 margin-right:8px;
}
.chat{
 padding:12px;
 overflow-y:auto;
 height:75vh;
}
.me{
 background:#3b7bfd;
 padding:10px;
 border-radius:12px;
 margin:8px 0;
 width:fit-content;
 max-width:85%;
 margin-left:auto;
 color:white;
}
.bot{
 background:#1f2a44;
 padding:10px;
 border-radius:12px;
 margin:8px 0;
 width:fit-content;
 max-width:85%;
 color:white;
}
.footer{
 display:flex;
 padding:10px;
 gap:6px;
 background:#0f1629;
}
input{
 flex:1;
 padding:10px;
 border-radius:8px;
 border:none;
 outline:none;
 background:#0b1220;
 color:white;
}
button{
 background:#3b7bfd;
 color:white;
 border:none;
 padding:10px 15px;
 border-radius:8px;
}
.delete-btn{
 background:#ff4747;
 border-radius:10px;
 padding:8px 15px;
}
</style>
</head>

<body>

<div class="header">
 <div style="display:flex;align-items:center">
  <img src="https://img1.pixhost.to/images/10993/672136981_dikzz.jpg" class="icon">
  REZ‚Ä¢oneXD AI Chat
 </div>

 <button class="delete-btn" onclick="clearSession()">Hapus Sesi</button>
</div>

<div class="chat" id="chatBox"></div>

<div class="footer">
 <input id="input" placeholder="Ketik pesan...">
 <button onclick="sendMessage()">Kirim</button>
</div>

<script>
const API = "https://romzi.vercel.app/ai/ciciai?query=";

let session = {
 system:
 "Kamu adalah REZ‚Ä¢oneXD, asisten AI milik Gx Dikzz. Jawab sopan, santai, tidak menyebut nama AI lain. Nama kamu BUKAN Cici. Ingat percakapan sebelumnya.",
 history:[]
};

const chatBox = document.getElementById("chatBox");
const input = document.getElementById("input");

// LOAD SESSION
function load(){
 let saved = localStorage.getItem("rezonexd_ai");
 if(saved){
  session = JSON.parse(saved);
 }
 render();
}
load();

// SAVE SESSION
function save(){
 localStorage.setItem("rezonexd_ai", JSON.stringify(session));
}

// RENDER CHAT
function render(){
 chatBox.innerHTML = "";
 session.history.forEach(m=>{
  addMessage(m.role==="user"?"me":"bot", m.text);
 });
 chatBox.scrollTop = chatBox.scrollHeight;
}

// ADD MESSAGE UI
function addMessage(type,text){
 let div=document.createElement("div");
 div.className=type;
 div.innerText=text;
 chatBox.appendChild(div);
 chatBox.scrollTop = chatBox.scrollHeight;
}

// CLEAR SESSION
function clearSession(){
 localStorage.removeItem("rezonexd_ai");
 session.history=[];
 render();
 alert("Sesi berhasil dihapus");
}

// SEND MESSAGE
async function sendMessage(){
 let text = input.value.trim();
 if(!text) return;
 input.value="";

 addMessage("me", text);
 session.history.push({role:"user", text});
 save();

 let typing = document.createElement("div");
 typing.className="bot";
 typing.innerText="üé§ AI sedang merekam...";
 chatBox.appendChild(typing);
 chatBox.scrollTop = chatBox.scrollHeight;

 // bangun konteks
 let context = session.system + "\n\n";
 session.history.slice(-8).forEach(m=>{
  context += (m.role==="user"?"User: ":"AI: ") + m.text + "\n";
 });

 try{
  const res = await fetch(API + encodeURIComponent(context));
  const data = await res.json();

  typing.remove();

  let reply = data?.data?.answer || "Maaf, AI tidak memberikan respon.";
  // pastikan nama benar
  reply = reply.replace(/Cici|Ciciai|CICI/gi,"REZ‚Ä¢oneXD");

  session.history.push({role:"bot", text:reply});
  save();
  addMessage("bot", reply);

 }catch(e){
  typing.remove();
  let err = "‚ö†Ô∏è Koneksi error, coba lagi nanti.";
  session.history.push({role:"bot", text:err});
  save();
  addMessage("bot", err);
 }
}
</script>

</body>
</html>